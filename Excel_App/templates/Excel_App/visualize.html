{% extends 'Excel_App/base.html' %}
{% load static %}

{% block extra_css %}
<style>
    /* Import Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Roboto:wght@400;500&display=swap');

    :root {
        --main-color: #1B73FB;
        --purple-card: #6C5CE7;
        --blue-card: #0984E3;
        --green-card: #00B894;
        --orange-card: #E17055;
        --card-radius: 20px;
        --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .file-info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px;
        padding: 20px;
        font-family: 'Poppins', sans-serif;
    }

    .info-card {
        background: white;
        padding: 25px;
        border-radius: var(--card-radius);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: var(--card-shadow);
    }

    .info-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.2));
        z-index: 1;
    }

    .info-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }

    .info-card.filename {
        background: linear-gradient(135deg, var(--purple-card), #a29bfe);
        grid-column: 1 / -1;
    }

    .info-card.size {
        background: linear-gradient(135deg, var(--blue-card), #74b9ff);
    }

    .info-card.uploaded {
        background: linear-gradient(135deg, var(--green-card), #55efc4);
    }

    .info-card.dimensions {
        background: linear-gradient(135deg, var(--orange-card), #fab1a0);
    }

    .info-card.last-update {
        background: linear-gradient(135deg, #00b09b, #96c93d);
        position: relative;
        overflow: hidden;
    }

    .info-card.last-update .update-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255, 255, 255, 0.2);
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        color: white;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.05);
            opacity: 0.8;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .info-label {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 10px;
        font-weight: 500;
    }

    .info-value {
        font-size: 1.5rem;
        color: white;
        font-weight: 600;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .info-icon {
        position: absolute;
        bottom: 20px;
        right: 20px;
        font-size: 3rem;
        color: rgba(255, 255, 255, 0.2);
        z-index: 0;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .info-card:hover .info-icon {
        animation: pulse 1.5s infinite;
    }

    /* Modern Theme Colors */
    :root {
        --main-color: #1B73FB;
        --bg-color: #f0f5ff;
        --card-bg: #ffffff;
        --shadow: 0 8px 30px rgba(27, 115, 251, 0.15);
        --border-radius: 15px;
    }

    body {
        background-color: var(--bg-color);
        padding: 20px;
    }

    /* Modern Card Design */
    .section {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        padding: 25px;
        margin-bottom: 30px;
        border: 1px solid rgba(27, 115, 251, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .section:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(27, 115, 251, 0.2);
    }

    /* Modern Button Design */
    .btn {
        border-radius: 10px;
        padding: 12px 24px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary, .btn-info, .calculate-btn {
        background: linear-gradient(45deg, var(--main-color), #4990ff);
        border: none;
        color: white;
        box-shadow: 0 4px 15px rgba(27, 115, 251, 0.2);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(27, 115, 251, 0.3);
    }

    /* Modern Table Design */
    .table {
        border-radius: var(--border-radius);
        overflow: hidden;
        border: none;
    }

    .table thead th {
        background: linear-gradient(45deg, var(--main-color), #4990ff);
        color: white;
        padding: 15px;
        font-weight: 500;
        border: none;
    }

    .table tbody tr {
        transition: all 0.3s ease;
    }

    .table tbody tr:hover {
        background-color: rgba(27, 115, 251, 0.05);
        transform: scale(1.01);
    }

    /* Modern Form Controls */
    .form-control, .form-select {
        border-radius: 10px;
        padding: 12px;
        border: 2px solid #e1e8ff;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 3px rgba(27, 115, 251, 0.1);
    }

    /* File Icon Animation */
    .file-icon {
        font-size: 5rem;
        color: var(--main-color);
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0); }
    }

    /* Statistics Cards */
    .stats-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        margin: 10px 0;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
    }

    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(27, 115, 251, 0.2);
    }

    /* Filter Controls */
    .filter-controls {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: var(--shadow);
    }

    .search-input {
        position: relative;
    }

    .search-input i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--main-color);
    }

    .search-input input {
        padding-left: 45px;
    }

    /* Search Controls Styles */
    .search-container {
        margin-bottom: 20px;
        width: 100%;
    }

    .search-input-group {
        display: flex;
        gap: 15px;
        align-items: center;
        background: white;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .search-input-group select,
    .search-input-group input {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 8px 15px;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .search-input-group select {
        width: 200px;
        background-color: white;
    }

    .search-input-group input {
        flex: 1;
        min-width: 200px;
    }

    .search-input-group select:focus,
    .search-input-group input:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 3px rgba(27, 115, 251, 0.15);
        outline: none;
    }

    .search-input-group i {
        color: #666;
        font-size: 16px;
    }

    @media (max-width: 768px) {
        .search-input-group {
            flex-direction: column;
            align-items: stretch;
        }

        .search-input-group select,
        .search-input-group input {
            width: 100%;
        }
    }

    .search-input-wrapper {
        position: relative;
        flex: 1;
    }

    .search-input-wrapper input {
        width: 100%;
        padding-right: 40px;
    }

    .search-input-wrapper .search-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-size: 16px;
        pointer-events: none;
    }

    .search-input-group {
        display: flex;
        gap: 15px;
        align-items: center;
        background: white;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .search-input-group select {
        width: 200px;
        background-color: white;
    }

    @media (max-width: 768px) {
        .search-input-group {
            flex-direction: column;
            align-items: stretch;
        }

        .search-input-group select,
        .search-input-wrapper {
            width: 100%;
        }
    }

    /* Toast Notifications */
    .toast-container {
        position: fixed;
        top: 20px !important;
        right: 20px !important;
        z-index: 9999;
    }

    .toast {
        background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
        border: none !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;
        min-width: 300px;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.4s ease-in-out !important;
        position: relative;
    }

    .toast.showing {
        opacity: 1;
        transform: translateX(0);
    }

    .toast.show {
        opacity: 1;
        transform: translateX(0);
    }

    .toast.hide {
        opacity: 0;
        transform: translateX(100%);
    }

    .toast.bg-danger {
        background: linear-gradient(135deg, #FF6778, #FF6778) !important;
    }

    .toast .toast-content {
        padding: 12px 35px 12px 15px;
    }

    .toast .toast-body {
        padding: 0;
        font-size: 0.95rem;
        font-weight: 500;
        color: white;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toast .btn-close {
        position: absolute !important;
        top: 8px !important;
        right: 8px !important;
        padding: 8px !important;
        margin: 0 !important;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }

    .toast .btn-close:hover {
        opacity: 1;
    }

    /* Toast Animations and Styling */
    @keyframes toastSlideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes toastSlideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    @keyframes iconBounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
    }

    .toast {
        animation: toastSlideIn 0.3s ease forwards;
    }

    .toast.hide {
        animation: toastSlideOut 0.3s ease forwards;
    }

    .toast .toast-content {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 15px;
    }

    .toast .toast-icon {
        font-size: 1.25rem;
        animation: iconBounce 0.5s ease;
    }

    .toast .toast-body {
        margin: 0;
        padding: 0;
    }

    .toast.bg-success .toast-icon {
        color: #ffffff;
    }

    .toast.bg-danger .toast-icon {
        color: #ffffff;
    }

    .toast.bg-info .toast-icon {
        color: #ffffff;
    }

    /* Loading Animation */
    .loading {
        position: relative;
        overflow: hidden;
    }

    .loading::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* Keep existing styles */
    :root {
        --main-color: #1B73FB;
    }

    .btn-primary {
        background-color: var(--main-color);
        border-color: var(--main-color);
    }

    .btn-primary:hover {
        background-color: #1560d6;
        border-color: #1560d6;
    }

    .btn-info {
        background-color: var(--main-color);
        border-color: var(--main-color);
        color: white;
    }

    .btn-info:hover {
        background-color: #1560d6;
        border-color: #1560d6;
        color: white;
    }

    .alert-info {
        background-color: #e8f0fe;
        border-color: var(--main-color);
        color: var(--main-color);
    }

    .section h3 i {
        color: var(--main-color);
    }

    .editing {
        background-color: #e8f0fe !important;
        border: 1px solid var(--main-color) !important;
    }

    .table thead th {
        background-color: var(--main-color);
        color: white;
    }

    .form-select:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 0.25rem rgba(27, 115, 251, 0.25);
    }

    .form-control:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 0.25rem rgba(27, 115, 251, 0.25);
    }

    .excel-container {
        background-color: #EEF8FF;
        margin: 0 auto;
        border-radius: 30px;
        padding: 2rem;
        min-height: calc(100vh - 4rem);
        width: 105%;          /* This makes it take up 95% of the container width */
        max-width: 1600px;   /* This prevents it from getting too wide on large screens */
    }

    .section {
        margin-bottom: 2rem;
        padding: 1rem;
        background: #fff;
        border-radius: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .section h3 {
        margin-bottom: 1rem;
        color: #333;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Section Title Styles */
    .section-title {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 2.2rem;
        font-weight: 700;
        color: #2d3436;
        margin-bottom: 2rem;
        padding: 1.2rem;
        background: linear-gradient(120deg, #ffffff 0%, #f8faff 100%);
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(27, 115, 251, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .section-title::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 5px;
        background: var(--main-color);
        border-radius: 3px;
    }

    .section-title::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(120deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
        pointer-events: none;
    }

    .section-title:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(27, 115, 251, 0.15);
    }

    .section-title .icon-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 65px;
        height: 65px;
        animation: iconFloat 3s ease-in-out infinite;
    }

    .section-title .icon-wrapper i {
        font-size: 2.8rem;
        color: var(--main-color);
        animation: iconPulse 2s ease-in-out infinite;
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 2px 4px rgba(27, 115, 251, 0.2));
    }

    @keyframes iconPulse {
        0%, 100% {
            transform: scale(1);
            filter: drop-shadow(0 0 2px rgba(27, 115, 251, 0.2));
        }
        50% {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(27, 115, 251, 0.4));
        }
    }

    @keyframes iconFloat {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-3px);
        }
    }

    /* Table Styles */
    .table-responsive {
        overflow-x: auto;
        margin-top: 1rem;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }

    th {
        background: #f8f9fa;
        padding: 12px;
        font-weight: 600;
        text-align: left;
        border: 1px solid #dee2e6;
        position: sticky;
        top: 0;
        z-index: 1;
    }

    td {
        padding: 8px 12px;
        border: 1px solid #dee2e6;
    }

    tbody tr:hover {
        background-color: #f8f9fa;
    }

    /* Search and Filter Styles */
    .search-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .search-input {
        flex: 1;
        position: relative;
    }

    .search-input i {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }

    .search-input input {
        padding-left: 30px;
    }

    /* Loading Spinner */
    .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
    }

    /* Utility Classes */
    .hidden {
        display: none !important;
    }

    /* Button Styles */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn i {
        font-size: 1rem;
    }

    .btn-success {
        background-color: #198754;
        border-color: #198754;
        color: white;
    }

    .btn-success:hover {
        background-color: #157347;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #5c636a;
    }

    .calculate-btn {
        background-color: #0d6efd;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 32px;
        height: 45px;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
    }

    .calculate-btn i {
        font-size: 16px;
    }

    .calculate-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%) scale(0);
        border-radius: 50%;
        transition: transform 0.5s ease;
    }

    .calculate-btn:hover {
        background-color: #0b5ed7;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
    }

    .calculate-btn:hover::before {
        transform: translate(-50%, -50%) scale(2);
    }

    .calculate-btn:hover i {
        transform: rotate(180deg);
    }

    .calculate-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
    }

    @keyframes calculatePulse {
        0% {
            box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.4);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(13, 110, 253, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(13, 110, 253, 0);
        }
    }

    .calculate-btn.calculating {
        animation: calculatePulse 1.5s infinite;
        pointer-events: none;
        opacity: 0.8;
    }

    .calculate-btn.calculating i {
        animation: iconPulse 1s infinite;
    }

    .file-name i {
        color: var(--main-color);
        font-size: 3.5rem;
        margin-right: 15px;
        transition: all 0.3s ease;
    }

    .file-name i:hover {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 0 10px var(--main-color));
    }

    .excel-icon-container {
        position: relative;
        display: inline-block;
    }

    .excel-icon-container::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 120%;
        height: 120%;
        background: radial-gradient(circle, rgba(27,115,251,0.1) 0%, rgba(27,115,251,0) 70%);
        transform: translate(-50%, -50%);
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .excel-icon-container:hover::after {
        opacity: 1;
    }

    @keyframes iconPulse {
        0% {
            transform: scale(1);
            filter: drop-shadow(0 0 0 var(--main-color));
        }
        50% {
            transform: scale(1.05);
            filter: drop-shadow(0 0 10px var(--main-color));
        }
        100% {
            transform: scale(1);
            filter: drop-shadow(0 0 0 var(--main-color));
        }
    }

    @keyframes iconFloat {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-5px);
        }
    }

    /* Filter System */
    .filter-controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .filter-group {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    /* Modern Section Titles */
    /* .section-title {
        font-family: 'Raleway', sans-serif;
        font-size: 2.2rem;
        font-weight: 800;
        color: #2d3436;
        margin-bottom: 1.5rem;
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        transform-origin: left;
        animation: slideInTitle 0.6s ease-out forwards;
    }

    .section-title i {
        font-size: 2rem;
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: pulseIcon 2s infinite;
    }

    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(to right, var(--main-color), #74b9ff);
        border-radius: 2px;
        animation: expandLine 0.6s ease-out forwards;
    }

    .section-title:hover i {
        transform: scale(1.1);
        transition: transform 0.3s ease;
    }

    @keyframes slideInTitle {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulseIcon {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
        }
    }

    @keyframes expandLine {
        from {
            width: 0;
            opacity: 0;
        }
        to {
            width: 60px;
            opacity: 1;
        }
    } */

    /* Enhanced File Icon Styles */
    .excel-logo {
        width: 120px;
        height: 120px;
        position: relative;
        margin: 20px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(27, 115, 251, 0.1) 0%, rgba(27, 115, 251, 0.05) 100%);
        border-radius: 24px;
        box-shadow: 0 8px 32px rgba(27, 115, 251, 0.08);
        animation: logoFloat 3s ease-in-out infinite;
        margin-top: 2rem;
        margin-bottom: 2rem;
    }

    .excel-logo::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        width: 90%;
        height: 20px;
        transform: translateX(-50%);
        background: radial-gradient(ellipse at center, rgba(27, 115, 251, 0.15) 0%, rgba(27, 115, 251, 0) 70%);
        animation: shadowPulse 3s ease-in-out infinite;
    }

    .excel-logo svg {
        width: 120px;
        height: 120px;
    }

    .excel-logo .circle {
        fill: none;
        stroke: var(--main-color);
        stroke-width: 4;
        stroke-dasharray: 283;
        animation: rotateCircle 8s linear infinite;
    }

    .excel-logo .cells {
        stroke: var(--main-color);
        stroke-width: 3;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
        animation: cellsPulse 3s ease-in-out infinite;
    }

    .excel-logo .chart {
        stroke: var(--main-color);
        stroke-width: 3;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
        stroke-dasharray: 100;
        animation: chartDraw 4s ease-in-out infinite;
    }

    .excel-logo .sparkles path {
        fill: var(--main-color);
        transform-origin: center;
    }

    .excel-logo .sparkle1 { animation: sparkleRotate 3s ease-in-out infinite; }
    .excel-logo .sparkle2 { animation: sparkleRotate 3s ease-in-out infinite 1s; }
    .excel-logo .sparkle3 { animation: sparkleRotate 3s ease-in-out infinite 2s; }

    @keyframes logoFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    @keyframes shadowPulse {
        0%, 100% {
            transform: translateX(-50%) scale(1);
            opacity: 0.3;
        }
        50% {
            transform: translateX(-50%) scale(0.8);
            opacity: 0.1;
        }
    }

    @keyframes rotateCircle {
        0% {
            transform: rotate(0deg);
            stroke-dashoffset: 283;
        }
        50% {
            stroke-dashoffset: 0;
        }
        100% {
            transform: rotate(360deg);
            stroke-dashoffset: -283;
        }
    }

    @keyframes cellsPulse {
        0%, 100% {
            opacity: 1;
            transform: scale(1);
        }
        50% {
            opacity: 0.7;
            transform: scale(0.95);
        }
    }

    @keyframes chartDraw {
        0% {
            stroke-dashoffset: 100;
            opacity: 0.5;
        }
        25% {
            stroke-dashoffset: 0;
            opacity: 1;
        }
        50% {
            stroke-dashoffset: -100;
            opacity: 0.5;
        }
        75% {
            stroke-dashoffset: -200;
            opacity: 1;
        }
        100% {
            stroke-dashoffset: -300;
            opacity: 0.5;
        }
    }

    @keyframes sparkleRotate {
        0% {
            transform: scale(1) rotate(0deg);
            opacity: 1;
        }
        33% {
            transform: scale(1.2) rotate(120deg);
            opacity: 0.8;
        }
        66% {
            transform: scale(0.8) rotate(240deg);
            opacity: 0.6;
        }
        100% {
            transform: scale(1) rotate(360deg);
            opacity: 1;
        }
    }

    .excel-logo:hover .circle {
        animation: rotateCircle 4s linear infinite;
    }

    .excel-logo:hover .chart {
        animation: chartDraw 2s ease-in-out infinite;
    }

    .excel-logo:hover .sparkles path {
        animation-duration: 1.5s;
    }

    /* Enhanced Table Styles */
    .table-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.05);
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .table-container:hover {
        box-shadow: 0 12px 40px rgba(0,0,0,0.08);
    }

    .data-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-bottom: 0;
    }

    .data-table thead th {
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        color: white;
        font-family: 'Poppins', sans-serif;
        font-weight: 600;
        padding: 1rem;
        position: sticky;
        top: 0;
        z-index: 10;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
        border: none;
    }

    .data-table tbody tr {
        transition: all 0.2s ease;
    }

    .data-table tbody tr:hover {
        background-color: rgba(27, 115, 251, 0.05);
        transform: scale(1.001);
    }

    .data-table td {
        padding: 1rem;
        border: none;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.95rem;
        color: #2d3436;
        vertical-align: middle;
    }

    .data-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* Table Search and Controls */
    .table-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .search-container {
        flex: 1;
        min-width: 250px;
        position: relative;
    }

    .search-container input {
        width: 100%;
        padding: 0.8rem 1rem 0.8rem 2.8rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: white;
    }

    .search-container input:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 4px rgba(27, 115, 251, 0.1);
        outline: none;
    }

    .search-container i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #a0a0a0;
        transition: color 0.3s ease;
    }

    .search-container input:focus + i {
        color: var(--main-color);
    }

    /* Pagination Styles */
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #ffffff;
        margin-top: 1rem;
    }

    .pagination-info {
        color: #718096;
        font-size: 0.9rem;
    }

    .pagination-controls {
        display: flex;
        gap: 0.5rem;
    }

    .page-button {
        padding: 0.5rem 1rem;
        border: none;
        background: white;
        color: var(--main-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid #e2e8f0;
    }

    .page-button:hover {
        background: var(--main-color);
        color: white;
        transform: translateY(-1px);
    }

    .page-button.active {
        background: var(--main-color);
        color: white;
    }

    /* Responsive Table */
    @media (max-width: 768px) {
        .table-container {
            border-radius: 10px;
            margin: 0 -15px;
        }

        .data-table td, 
        .data-table th {
            padding: 0.8rem;
            font-size: 0.9rem;
        }

        .table-controls {
            flex-direction: column;
        }

        .search-container {
            width: 100%;
        }
    }

    /* Modern Format Selector Styles */
    .format-selector {
        display: flex;
        gap: 1rem;
        margin: 1rem 0;
    }

    .format-option {
        flex: 1;
        position: relative;
        cursor: pointer;
    }

    .format-option input[type="radio"] {
        display: none;
    }

    .format-option label {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1.5rem;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .format-option label:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
    }

    .format-option label i {
        font-size: 2rem;
        margin-bottom: 0.8rem;
        color: #2d3436;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
    }

    .format-option label span {
        font-size: 1rem;
        font-weight: 500;
        color: #2d3436;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
    }

    .format-option input[type="radio"]:checked + label {
        border-color: var(--main-color);
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(27, 115, 251, 0.15);
    }

    .format-option input[type="radio"]:checked + label:before {
        opacity: 0.1;
    }

    .format-option input[type="radio"]:checked + label i,
    .format-option input[type="radio"]:checked + label span {
        color: var(--main-color);
    }

    .format-option label:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }

    @keyframes selectPulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }

    .format-option input[type="radio"]:checked + label i {
        animation: selectPulse 0.5s ease;
    }

    /* Download Button Enhancement */
    .download-btn {
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        margin-left: 1rem;
    }

    .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(27, 115, 251, 0.2);
    }

    .download-btn:active {
        transform: scale(0.98);
    }

    .download-btn i {
        font-size: 1rem;
    }

    /* Reload Button Styles */
    .action-btn {
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        background: var(--main-color);
        font-size: 16px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
        height: 45px;
    }

    .action-btn:hover {
        transform: translateY(-2px);
    }

    .action-btn:active {
        transform: scale(0.98);
    }

    .action-btn i {
        transition: transform 0.5s ease;
    }

    /* Edit Button Styles */
    .edit-btn {
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        box-shadow: 0 8px 15px rgba(27, 115, 251, 0.2);
    }

    .edit-btn:hover {
        box-shadow: 0 8px 15px rgba(27, 115, 251, 0.3);
    }

    /* Save Button Styles */
    .save-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        box-shadow: 0 8px 15px rgba(40, 167, 69, 0.2);
    }

    .save-btn:hover {
        box-shadow: 0 8px 15px rgba(40, 167, 69, 0.3);
    }

    /* Reload Button Styles */
    .reload-btn {
        background: linear-gradient(135deg, #57E0BF, #57E0BF);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }

    .reload-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(87, 224, 191, 0.3);
    }

    .reload-btn.loading {
        background: linear-gradient(135deg, #57E0BF, #57E0BF);
        opacity: 0.7;
        pointer-events: none;
    }

    .reload-btn i {
        transition: transform 0.3s ease;
    }

    .reload-btn.loading i {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Action Buttons Container */
    .action-buttons {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: nowrap;
    }

    /* Download Button Styles */
    .download-btn {
        background: linear-gradient(135deg, #0097e6, #00a8ff);
        box-shadow: 0 8px 15px rgba(0, 151, 230, 0.2);
    }

    .download-btn:hover {
        box-shadow: 0 8px 15px rgba(0, 151, 230, 0.3);
    }

    /* Format Selection Container */
    .format-selection {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .format-select {
        padding: 12px 20px;
        border-radius: 10px;
        border: 2px solid rgba(27, 115, 251, 0.2);
        margin: 0 17px;
        font-size: 14px;
        height: 45px;
        line-height: 21px;
        background-color: white;
        min-width: 140px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(27, 115, 251, 0.05);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231B73FB' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 16px;
        padding-right: 40px;
    }

    .format-select:hover {
        border-color: rgba(27, 115, 251, 0.4);
    }

    .format-select:focus {
        border-color: rgba(27, 115, 251, 0.6);
        box-shadow: 0 0 0 3px rgba(27, 115, 251, 0.1);
    }

    /* Modern Toast Styles */
    .toast-container {
        position: fixed;
        top: 20px !important;
        right: 20px !important;
        z-index: 9999;
    }

    .toast {
        background: linear-gradient(135deg, #2ecc71, #27ae60) !important;
        border: none !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;
        min-width: 300px;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.4s ease-in-out !important;
        position: relative;
    }

    .toast.showing {
        opacity: 1;
        transform: translateX(0);
    }

    .toast.show {
        opacity: 1;
        transform: translateX(0);
    }

    .toast.hide {
        opacity: 0;
        transform: translateX(100%);
    }

    .toast.bg-danger {
        background: linear-gradient(135deg, #FF6778, #FF6778) !important;
    }

    .toast .toast-content {
        padding: 12px 35px 12px 15px;
    }

    .toast .toast-body {
        padding: 0;
        font-size: 0.95rem;
        font-weight: 500;
        color: white;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toast .btn-close {
        position: absolute !important;
        top: 8px !important;
        right: 8px !important;
        padding: 8px !important;
        margin: 0 !important;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }

    .toast .btn-close:hover {
        opacity: 1;
    }

    /* No Results Found Styles */
    .no-results {
        display: none;
        text-align: center;
        padding: 2rem;
        color: #6c757d;
        animation: fadeInUp 0.5s ease-out;
    }

    .no-results i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #4393FD;
        animation: bounce 2s infinite;
    }

    .no-results h4 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: #495057;
    }

    .no-results p {
        color: #6c757d;
        margin-bottom: 0;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-20px);
        }
        60% {
            transform: translateY(-10px);
        }
    }

    /* Icon Wrapper Styles */
    .icon-wrapper {
        position: relative;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-wrapper i {
        position: absolute;
        font-size: 32px;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* File Information Icons */
    .icon-wrapper .success-icon {
        opacity: 0;
        transform: scale(0.5) rotate(-180deg);
        color: #28a745;
    }

    .icon-wrapper .loading-icon {
        opacity: 0;
        transform: scale(0.5);
    }

    .section-title:hover .icon-wrapper .main-icon {
        animation: mainIconOut 0.5s forwards;
    }

    .section-title:hover .icon-wrapper .success-icon {
        animation: successIconIn 0.5s forwards 0.1s;
    }

    /* Statistical Analysis Icons */
    .icon-wrapper .math-icon,
    .icon-wrapper .percent-icon {
        opacity: 0;
        transform: scale(0.5) translateY(20px);
    }

    .section-title:hover .icon-wrapper .math-icon {
        animation: mathIconFloat 0.6s forwards;
    }

    .section-title:hover .icon-wrapper .percent-icon {
        animation: percentIconFloat 0.6s forwards 0.2s;
    }

    /* Chart Icons */
    .icon-wrapper .chart-line-icon,
    .icon-wrapper .chart-pie-icon {
        opacity: 0;
        transform: scale(0.5) rotate(45deg);
    }

    .section-title:hover .icon-wrapper .chart-line-icon {
        animation: chartLineIn 0.5s forwards;
    }

    .section-title:hover .icon-wrapper .chart-pie-icon {
        animation: chartPieIn 0.5s forwards 0.2s;
    }

    /* Table Icons */
    .icon-wrapper .grid-icon,
    .icon-wrapper .sort-icon {
        opacity: 0;
        transform: scale(0.5) translateX(-20px);
    }

    .section-title:hover .icon-wrapper .grid-icon {
        animation: gridIconSlide 0.5s forwards;
    }

    .section-title:hover .icon-wrapper .sort-icon {
        animation: sortIconSlide 0.5s forwards 0.2s;
    }

    /* Icon Animations */
    @keyframes mainIconOut {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        100% {
            transform: scale(0.5) translateX(-20px);
            opacity: 0;
        }
    }

    @keyframes successIconIn {
        0% {
            transform: scale(0.5) rotate(-180deg);
            opacity: 0;
        }
        100% {
            transform: scale(1) rotate(0);
            opacity: 1;
        }
    }

    @keyframes mathIconFloat {
        0% {
            transform: scale(0.5) translateY(20px);
            opacity: 0;
        }
        100% {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
    }

    @keyframes percentIconFloat {
        0% {
            transform: scale(0.5) translateY(20px);
            opacity: 0;
        }
        100% {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
    }

    @keyframes chartLineIn {
        0% {
            transform: scale(0.5) rotate(45deg);
            opacity: 0;
        }
        100% {
            transform: scale(1) rotate(0);
            opacity: 1;
        }
    }

    @keyframes chartPieIn {
        0% {
            transform: scale(0.5) rotate(45deg);
            opacity: 0;
        }
        100% {
            transform: scale(1) rotate(0);
            opacity: 1;
        }
    }

    @keyframes gridIconSlide {
        0% {
            transform: scale(0.5) translateX(-20px);
            opacity: 0;
        }
        100% {
            transform: scale(1) translateX(0);
            opacity: 1;
        }
    }

    @keyframes sortIconSlide {
        0% {
            transform: scale(0.5) translateX(-20px);
            opacity: 0;
        }
        100% {
            transform: scale(1) translateX(0);
            opacity: 1;
        }
    }

    /* Update icon gradients */
    .icon-wrapper .main-icon {
        background: linear-gradient(135deg, var(--main-color) 0%, #4a90e2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .icon-wrapper .success-icon {
        background: linear-gradient(135deg, #28a745 0%, #34ce57 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .icon-wrapper .math-icon {
        background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .icon-wrapper .chart-line-icon,
    .icon-wrapper .chart-pie-icon {
        background: linear-gradient(135deg, #6B5B95 0%, #9B89B3 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .icon-wrapper .grid-icon,
    .icon-wrapper .sort-icon {
        background: linear-gradient(135deg, #45B7D1 0%, #4FB0C6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Section Title Icon Animations */
    .section-title .icon-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        animation: iconFloat 3s ease-in-out infinite;
    }

    .section-title .icon-wrapper i {
        font-size: 1.5rem;
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
        0%, 100% {
            transform: scale(1);
            filter: drop-shadow(0 0 2px rgba(27, 115, 251, 0.2));
        }
        50% {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(27, 115, 251, 0.4));
        }
    }

    @keyframes iconFloat {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-3px);
        }
    }

    /* Add styles for copy button */
    .copy-stats-btn {
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, var(--main-color), #74b9ff);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: none;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        margin-left: 1rem;
    }

    .copy-stats-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(27, 115, 251, 0.2);
    }

    .copy-stats-btn i {
        font-size: 1rem;
    }

    .result-container {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    /* Statistical Analysis Styles */
    .calculate-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 20px;
        background: linear-gradient(135deg, #1b73fb 0%, #1557c0 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(27, 115, 251, 0.2);
        min-width: 130px;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(27, 115, 251, 0.3);
    }

    .calculate-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(27, 115, 251, 0.2);
    }

    .calculate-btn i {
        font-size: 1.1em;
        transition: transform 0.3s ease;
    }

    .calculate-btn:hover i {
        transform: scale(1.1);
    }

    .calculate-btn.calculating {
        position: relative;
        pointer-events: none;
        background: linear-gradient(135deg, #1557c0 0%, #1b73fb 100%);
    }

    .calculate-btn.calculating i {
        animation: iconPulse 1s infinite;
    }

    .result-container {
        position: relative;
        margin-top: 1rem;
    }

    #analysisResult {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 0;
        font-weight: 500;
        color: #495057;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .copy-stats-btn {
        display: none;
        align-items: center;
        gap: 6px;
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        padding: 6px 12px;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        color: #495057;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .copy-stats-btn:hover {
        background: #f8f9fa;
        border-color: #ced4da;
        color: #1b73fb;
    }

    .copy-stats-btn i {
        font-size: 0.9em;
    }

    @keyframes iconPulse {
        0%, 100% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.2);
            opacity: 0.8;
        }
    }

    /* Form Select Styles */
    .form-select {
        padding: 10px 15px;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        background-color: white;
        color: #495057;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-select:hover {
        border-color: #1b73fb;
    }

    .form-select:focus {
        border-color: #1b73fb;
        box-shadow: 0 0 0 3px rgba(27, 115, 251, 0.2);
        outline: none;
    }

    /* Reset Button Styles */
    .reset-btn {
        padding: 8px 16px;
        background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: none;
        align-items: center;
        gap: 8px;
        margin-left: 8px;
    }

    .reset-btn:hover {
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        transform: translateY(-1px);
    }

    .reset-btn i {
        font-size: 14px;
    }

    /* Statistics Search Controls */
    .search-controls {
        display: flex;
        gap: 10px;
        margin-right: 15px;
    }

    .search-controls .form-control,
    .search-controls .form-select {
        min-width: 200px;
        height: 38px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        padding: 8px 12px;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .search-controls .form-control:focus,
    .search-controls .form-select:focus {
        border-color: var(--main-color);
        box-shadow: 0 0 0 3px rgba(27, 115, 251, 0.2);
        outline: none;
    }

    .statistics-table {
        margin-top: 15px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    }

    .statistics-table thead th {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        color: #495057;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 0.5px;
        padding: 12px 15px;
        border-bottom: 2px solid #dee2e6;
    }

    .statistics-table tbody td {
        padding: 12px 15px;
        border-bottom: 1px solid #dee2e6;
        font-size: 14px;
        color: #495057;
    }

    .statistics-table tbody tr:hover {
        background-color: rgba(27, 115, 251, 0.05);
    }

    .statistics-table .highlight-match {
        background-color: rgba(27, 115, 251, 0.2);
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-2">
    <div class="excel-container">
        <!-- File Information Section -->
        <div class="section">
            <h3 class="section-title">
                <div class="icon-wrapper">
                    <i class="fas fa-file-excel main-icon"></i>
                    <i class="fas fa-check-circle success-icon"></i>
                    <i class="fas fa-sync-alt loading-icon"></i>
                </div>
                File Information
            </h3>
            
            <!-- Excel Logo with Animation -->
            <div class="excel-logo">
                <svg viewBox="0 0 100 100">
                    <circle class="circle" cx="50" cy="50" r="45"/>
                    <g class="cells">
                        <rect x="30" y="30" width="40" height="40" rx="4"/>
                        <line x1="30" y1="40" x2="70" y2="40"/>
                        <line x1="30" y1="50" x2="70" y2="50"/>
                        <line x1="30" y1="60" x2="70" y2="60"/>
                        <line x1="40" y1="30" x2="40" y2="70"/>
                        <line x1="50" y1="30" x2="50" y2="70"/>
                        <line x1="60" y1="30" x2="60" y2="70"/>
                    </g>
                    <g class="chart">
                        <polyline points="35,55 45,45 55,58 65,35"/>
                    </g>
                    <g class="sparkles">
                        <path class="sparkle1" d="M25,25 L28,28 L25,31 L22,28 Z"/>
                        <path class="sparkle2" d="M70,20 L73,23 L70,26 L67,23 Z"/>
                        <path class="sparkle3" d="M75,65 L78,68 L75,71 L72,68 Z"/>
                    </g>
                </svg>
            </div>

            <div class="file-info-grid">
                <div class="info-card filename">
                    <div class="info-label">File Name</div>
                    <div class="info-value">{{ data.file_name }}</div>
                    <i class="fas fa-file-alt info-icon"></i>
                </div>
                <div class="info-card size">
                    <div class="info-label">Size</div>
                    <div class="info-value">{{ data.file_size }}</div>
                    <i class="fas fa-database info-icon"></i>
                </div>
                <div class="info-card uploaded">
                    <div class="info-label">Uploaded</div>
                    <div class="info-value">{{ data.upload_time }}</div>
                    <i class="fas fa-cloud-upload-alt info-icon"></i>
                </div>
                <div class="info-card dimensions">
                    <div class="info-label">Dimensions</div>
                    <div class="info-value">{{ data.rows_count }} × {{ data.columns_count }}</div>
                    <i class="fas fa-table info-icon"></i>
                </div>
                <div class="info-card last-update">
                    <div class="update-badge">Last Edit</div>
                    <div class="info-label">Last Modified</div>
                    <div id="lastModified" class="info-value">{{ data.last_modified|default:"No edits yet" }}</div>
                    <i class="fas fa-history info-icon"></i>
                </div>
            </div>
        </div>

        <!-- Statistical Analysis Section -->
        <div class="section mb-4">
            <h3 class="section-title">
                <div class="icon-wrapper">
                    <i class="fas fa-calculator main-icon"></i>
                    <i class="fas fa-square-root-alt math-icon"></i>
                    <i class="fas fa-percentage percent-icon"></i>
                </div>
                Statistical Analysis
            </h3>
            <div class="card" style="border: none; box-shadow: none;">
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <select id="columnSelect" class="form-select">
                                <option value="">Select Column</option>
                                {% for column in data.columns %}
                                <option value="{{ column }}">{{ column }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select id="calculationType" class="form-select">
                                <option value="" selected disabled>Select Calculation</option>
                                <option value="sum">Sum</option>
                                <option value="average">Average</option>
                                <option value="count">Count</option>
                                <option value="min">Minimum</option>
                                <option value="max">Maximum</option>
                                <option value="median">Median</option>
                                <option value="mode">Mode</option>
                                <option value="stddev">Standard Deviation</option>
                                <option value="nullcount">Null Count</option>
                                <option value="nonnullcount">Non-Null Count</option>
                                <option value="datatype">Data Type</option>
                                <option value="statistics">Full Statistics</option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-center">
                            <button id="calculateBtn" class="calculate-btn">
                                <i class="fas fa-calculator"></i>
                                Calculate
                            </button>
                        </div>
                    </div>
                    <div class="result-container">
                        <div id="analysisResult" class="alert alert-info" style="display: none; margin-bottom: 0;"></div>
                        <button id="copyStatsBtn" class="copy-stats-btn" title="Copy Statistics">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                        <button id="resetStatsBtn" class="reset-btn" title="Reset Statistics">
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Overview Table -->
        <div class="section mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="section-title">
                    <div class="icon-wrapper">
                        <i class="fas fa-chart-bar main-icon"></i>
                        <i class="fas fa-chart-line chart-line-icon"></i>
                        <i class="fas fa-chart-pie chart-pie-icon"></i>
                    </div>
                    Statistics Overview
                </h3>
                <div class="action-buttons">
                    <button id="reloadStatsBtn" class="action-btn reload-btn" onclick="calculateStatistics(false)">
                        <i class="fas fa-sync-alt"></i> Reload Stats
                    </button>
                    <div class="format-selection">
                        <select id="statsFormat" class="format-select">
                            <option value="xlsx">Excel (.xlsx)</option>
                            <option value="xls">Excel 97-2003 (.xls)</option>
                            <option value="csv">CSV (.csv)</option>
                            <option value="txt">Text (.txt)</option>
                            <option value="json">JSON (.json)</option>
                        </select>
                        <button id="downloadStatsBtn" class="action-btn download-btn">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-controls">
                <div class="search-container">
                    <div class="search-input-group">
                        <select id="statsColumnFilter" class="form-select">
                            <option value="all">All Columns</option>
                            {% for column in stats_columns %}
                            <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                        <div class="search-input-wrapper">
                            <input type="text" id="statsSearch" class="form-control" placeholder="Search in statistics...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div id="statsNoResults" class="no-results" style="display: none;">
                <i class="fas fa-search"></i>
                <h4>No Results Found</h4>
                <p>Try adjusting your search criteria</p>
            </div>

            <div class="table-responsive">
                <table class="table statistics-table">
                    <thead>
                        <tr>
                            {% for column in stats_columns %}
                            <th>{{ column }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody id="statisticsBody">
                        {% for row in stats_data %}
                        <tr>
                            {% for value in row %}
                            <td>{{ value }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="section mt-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="section-title">
                    <div class="icon-wrapper">
                        <i class="fas fa-table main-icon"></i>
                        <i class="fas fa-th grid-icon"></i>
                        <i class="fas fa-sort-amount-down sort-icon"></i>
                    </div>
                    Data Table
                </h3>
                <div class="action-buttons">
                    <button id="reloadBtn" class="action-btn reload-btn">
                        <i class="fas fa-sync-alt"></i> Reload
                    </button>
                    <button id="editBtn" class="action-btn edit-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button id="saveBtn" class="action-btn save-btn hidden">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <div class="format-selection">
                        <select id="downloadFormat" class="format-select hidden">
                            <option value="xlsx">Excel (.xlsx)</option>
                            <option value="xls">Excel 97-2003 (.xls)</option>
                            <option value="csv">CSV (.csv)</option>
                            <option value="txt">Text (.txt)</option>
                            <option value="json">JSON (.json)</option>
                        </select>
                        <button id="downloadBtn" class="action-btn download-btn hidden">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-controls">
                <div class="search-container">
                    <div class="search-input-group">
                        <select id="filterColumn" class="form-select">
                            <option value="all">All Columns</option>
                            {% for column in data.columns %}
                            <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                        <div class="search-input-wrapper">
                            <input type="text" id="tableSearch" class="form-control" placeholder="Search in table...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="table data-table" id="dataTable">
                    <thead>
                        <tr>
                            {% for column in data.columns %}
                            <th>{{ column }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data.values %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div id="dataNoResults" class="no-results">
                <i class="fas fa-search"></i>
                <h4>No Results Found</h4>
                <p>Try adjusting your search criteria</p>
            </div>

            <div class="pagination-container">
                <div class="pagination-info">
                    Showing <span id="startRow">1</span> to <span id="endRow">10</span> of <span id="totalRows">0</span> entries
                </div>
                <div class="pagination-controls">
                    <button class="page-button" id="prevPage"><i class="fas fa-chevron-left"></i></button>
                    <button class="page-button active">1</button>
                    <button class="page-button" id="nextPage"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container position-fixed">
            <div id="successToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-content">
                    <div class="toast-icon fas"></div>
                    <div class="toast-body"></div>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            
            <div id="errorToast" class="toast align-items-center text-white border-0 bg-danger" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-content">
                    <div class="toast-icon fas"></div>
                    <div class="toast-body"></div>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>

        <script>
            
            document.addEventListener('DOMContentLoaded', function() {
                const table = document.getElementById('dataTable');
                const thead = table ? table.querySelector('thead') : null;
                const tbody = table ? table.querySelector('tbody') : null;
                const editBtn = document.getElementById('editBtn');
                const saveBtn = document.getElementById('saveBtn');
                const downloadBtn = document.getElementById('downloadBtn');
                const downloadFormat = document.getElementById('downloadFormat');
                const searchInput = document.getElementById('tableSearch');
                const columnFilter = document.getElementById('filterColumn');
                const statisticsBody = document.getElementById('statisticsBody');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const fileIndex = "{{ file_index }}";

                function calculateStatistics(showMessages = false) {
                    if (!table || !thead || !tbody) {
                        console.error('Table elements not found');
                        return;
                    }

                    try {
                        const headers = Array.from(thead.querySelectorAll('th')).map(th => th.textContent.trim());
                        const rows = Array.from(tbody.querySelectorAll('tr')).filter(row => row.style.display !== 'none');
                        const stats = {};
                        let hasNumericData = false;

                        // Initialize statistics for each column
                        headers.forEach((header, colIndex) => {
                            const allValues = rows.map(row => {
                                if (!row.cells || !row.cells[colIndex]) return null;
                                const cell = row.cells[colIndex];
                                const value = cell.textContent.trim();
                                const numValue = parseFloat(value);
                                return {
                                    raw: value,
                                    numeric: isNaN(numValue) ? null : numValue
                                };
                            });

                            // Count non-null and null values
                            const nonNullCount = allValues.filter(v => v && v.raw !== '').length;
                            const nullCount = allValues.length - nonNullCount;

                            // Get numeric values for calculations
                            const numericValues = allValues
                                .map(v => v ? v.numeric : null)
                                .filter(v => v !== null);

                            if (numericValues.length > 0) {
                                hasNumericData = true;
                                // Calculate mean
                                const sum = numericValues.reduce((a, b) => a + b, 0);
                                const mean = sum / numericValues.length;

                                // Calculate median
                                const sorted = [...numericValues].sort((a, b) => a - b);
                                const mid = Math.floor(sorted.length / 2);
                                const median = sorted.length % 2 === 0 
                                    ? (sorted[mid - 1] + sorted[mid]) / 2 
                                    : sorted[mid];

                                // Calculate mode
                                const valueCounts = {};
                                allValues.forEach(v => {
                                    if (v && v.raw) {
                                        valueCounts[v.raw] = (valueCounts[v.raw] || 0) + 1;
                                    }
                                });
                                const mode = Object.entries(valueCounts)
                                    .sort((a, b) => b[1] - a[1])[0][0];

                                // Calculate standard deviation
                                const squareDiffs = numericValues.map(value => Math.pow(value - mean, 2));
                                const avgSquareDiff = squareDiffs.reduce((a, b) => a + b, 0) / numericValues.length;
                                const stdDev = Math.sqrt(avgSquareDiff);

                                stats[header] = {
                                    dataType: 'Numeric',
                                    nonNullCount: nonNullCount,
                                    nullCount: nullCount,
                                    mean: mean,
                                    median: median,
                                    mode: mode,
                                    min: Math.min(...numericValues),
                                    max: Math.max(...numericValues),
                                    stdDev: stdDev
                                };
                            } else {
                                // For non-numeric columns
                                const valueCounts = {};
                                allValues.forEach(v => {
                                    if (v && v.raw) {
                                        valueCounts[v.raw] = (valueCounts[v.raw] || 0) + 1;
                                    }
                                });
                                const mode = Object.entries(valueCounts)
                                    .sort((a, b) => b[1] - a[1])[0][0];

                                stats[header] = {
                                    dataType: 'Text',
                                    nonNullCount: nonNullCount,
                                    nullCount: nullCount,
                                    mean: null,
                                    median: null,
                                    mode: mode,
                                    min: null,
                                    max: null,
                                    stdDev: null
                                };
                            }
                        });

                        // Update statistics table
                        if (statisticsBody) {
                            statisticsBody.innerHTML = '';
                            Object.entries(stats).forEach(([column, stat]) => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${column}</td>
                                    <td>${stat.dataType}</td>
                                    <td>${stat.nonNullCount}</td>
                                    <td>${stat.nullCount}</td>
                                    <td>${stat.mean !== null ? stat.mean.toFixed(2) : 'N/A'}</td>
                                    <td>${stat.median !== null ? stat.median.toFixed(2) : 'N/A'}</td>
                                    <td>${stat.mode || 'N/A'}</td>
                                    <td>${stat.min !== null ? stat.min.toFixed(2) : 'N/A'}</td>
                                    <td>${stat.max !== null ? stat.max.toFixed(2) : 'N/A'}</td>
                                    <td>${stat.stdDev !== null ? stat.stdDev.toFixed(2) : 'N/A'}</td>
                                `;
                                statisticsBody.appendChild(row);
                            });

                            // Show/hide no results message
                            const statsNoResults = document.getElementById('statsNoResults');
                            if (statsNoResults) {
                                statsNoResults.style.display = Object.keys(stats).length === 0 ? 'flex' : 'none';
                            }

                            // Only show messages if explicitly requested
                            if (showMessages) {
                                if (hasNumericData) {
                                    showToast('success', 'Statistics calculated successfully');
                                } else {
                                    showToast('error', 'No numeric data found in selected columns');
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error calculating statistics:', error);
                        if (showMessages) {
                            showToast('error', 'Error calculating statistics');
                        }
                    }
                }

                // Calculate statistics on page load (without showing messages)
                if (table && thead && tbody) {
                    calculateStatistics(false);
                }

                // Add reload stats functionality
                const reloadStatsBtn = document.getElementById('reloadStatsBtn');
                if (reloadStatsBtn) {
                    reloadStatsBtn.addEventListener('click', function() {
                        this.classList.add('loading');
                        setTimeout(() => {
                            calculateStatistics(false); // Do not show messages when manually reloading
                            this.classList.remove('loading');
                        }, 100);
                    });
                }

                // Search functionality for both tables
                let searchTimeout;
                const highlightClass = 'highlight-match';

                function highlightText(text, searchTerm) {
                    if (!searchTerm) return text;
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    return text.replace(regex, `<span class="highlight-match">$1</span>`);
                }

                function performTableSearch(tableElement, searchInput, columnFilter, noResultsElement) {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    const selectedColumn = columnFilter ? columnFilter.value : 'all';
                    const thead = tableElement.querySelector('thead');
                    const tbody = tableElement.querySelector('tbody');
                    let visibleRows = 0;
                    
                    // Clear previous highlights first
                    tbody.querySelectorAll('.highlight-match').forEach(highlight => {
                        const parent = highlight.parentNode;
                        parent.textContent = parent.textContent; // Remove highlight spans
                    });
                    
                    // Perform search
                    Array.from(tbody.querySelectorAll('tr')).forEach(row => {
                        let found = false;
                        
                        if (selectedColumn === 'all') {
                            // Search all columns
                            Array.from(row.cells).forEach(cell => {
                                const text = cell.textContent.trim();
                                if (text.toLowerCase().includes(searchTerm)) {
                                    cell.innerHTML = highlightText(text, searchTerm);
                                    found = true;
                                }
                            });
                        } else {
                            // Search specific column
                            const columnIndex = Array.from(thead.querySelectorAll('th'))
                                .findIndex(th => th.textContent.trim() === selectedColumn);
                            if (columnIndex !== -1) {
                                const cell = row.cells[columnIndex];
                                const text = cell.textContent.trim();
                                if (text.toLowerCase().includes(searchTerm)) {
                                    cell.innerHTML = highlightText(text, searchTerm);
                                    found = true;
                                }
                            }
                        }

                        row.style.display = found || !searchTerm ? '' : 'none';
                        if (found || !searchTerm) visibleRows++;
                    });

                    // Show/hide no results message
                    if (noResultsElement) {
                        if (searchTerm && visibleRows === 0) {
                            noResultsElement.style.display = 'block';
                            tableElement.style.display = 'none';
                        } else {
                            noResultsElement.style.display = 'none';
                            tableElement.style.display = 'table';
                        }
                    }

                    return visibleRows;
                }

                // Main data table search
                const dataTable = document.getElementById('dataTable');
                const dataSearchInput = document.getElementById('tableSearch');
                const dataColumnFilter = document.getElementById('filterColumn');
                const dataNoResults = document.getElementById('dataNoResults');
                const paginationContainer = document.querySelector('.pagination-container');

                if (dataSearchInput) {
                    dataSearchInput.addEventListener('input', function() {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            const visibleRows = performTableSearch(dataTable, dataSearchInput, dataColumnFilter, dataNoResults);
                            if (paginationContainer) {
                                paginationContainer.style.display = visibleRows > 0 ? 'flex' : 'none';
                            }
                            calculateStatistics(false);
                        }, 300);
                    });
                }

                if (dataColumnFilter) {
                    dataColumnFilter.addEventListener('change', function() {
                        const visibleRows = performTableSearch(dataTable, dataSearchInput, dataColumnFilter, dataNoResults);
                        if (paginationContainer) {
                            paginationContainer.style.display = visibleRows > 0 ? 'flex' : 'none';
                        }
                        calculateStatistics(false);
                    });
                }

                // Statistics table search
                const statsTable = document.querySelector('.statistics-table');
                const statsSearchInput = document.querySelector('#statsSearch');
                const statsColumnFilter = document.querySelector('#statsColumnFilter');
                const statsNoResults = document.querySelector('#statsNoResults');

                if (statsSearchInput) {
                    statsSearchInput.addEventListener('input', function() {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            performTableSearch(statsTable, statsSearchInput, statsColumnFilter, statsNoResults);
                        }, 300);
                    });
                }

                if (statsColumnFilter) {
                    statsColumnFilter.addEventListener('change', function() {
                        performTableSearch(statsTable, statsSearchInput, statsColumnFilter, statsNoResults);
                    });
                }

                // File actions
                downloadBtn.addEventListener('click', function() {
                    const format = downloadFormat.value;
                    window.location.href = `/download/${fileIndex}/?format=${format}`;
                    showToast('success', `Data table is being downloaded as ${format.toUpperCase()}`);
                });

                saveBtn.addEventListener('click', function() {
                    // Check if any cells were edited
                    const table = document.getElementById('dataTable');
                    if (!table) {
                        showToast('error', 'Table not found');
                        return;
                    }
                    
                    const tbody = table.querySelector('tbody');
                    if (!tbody) {
                        showToast('error', 'Table body not found');
                        return;
                    }

                    const thead = table.querySelector('thead');
                    if (!thead) {
                        showToast('error', 'Table header not found');
                        return;
                    }

                    // Get edited cells and check for changes
                    const cells = tbody.querySelectorAll('td');
                    let hasChanges = false;
                    
                    cells.forEach(cell => {
                        if (cell.classList.contains('editing')) {
                            const originalValue = cell.getAttribute('data-original') || '';
                            const currentValue = cell.textContent.trim();
                            if (originalValue !== currentValue) {
                                hasChanges = true;
                                console.log('Changed cell:', {
                                    original: originalValue,
                                    current: currentValue
                                });
                            }
                        }
                    });
                    
                    if (!hasChanges) {
                        showToast('error', 'Nothing to save. Please edit the table to save changes.');
                        return;
                    }
                    
                    // Get all table data
                    const headers = Array.from(thead.querySelectorAll('th')).map(th => th.textContent.trim());
                    const rows = Array.from(tbody.querySelectorAll('tr')).filter(row => row.style.display !== 'none');
                    
                    // Create data array in the format the server expects
                    const data = [];
                    rows.forEach(row => {
                        const rowData = {};
                        headers.forEach((header, index) => {
                            rowData[header] = row.cells[index].textContent.trim();
                        });
                        data.push(rowData);
                    });
                    
                    console.log('Sending data to server:', data);
                    
                    // Show saving indicator
                    showToast('info', 'Saving changes...');
                    
                    // Send to server
                    fetch(`/save_changes/${fileIndex}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify({ data: data })
                    })
                    .then(response => {
                        console.log('Server response status:', response.status);
                        if (!response.ok) {
                            return response.text().then(text => {
                                console.error('Server error response:', text);
                                try {
                                    const errorData = JSON.parse(text);
                                    throw new Error(errorData.error || 'Failed to save changes');
                                } catch (e) {
                                    throw new Error('Failed to save changes');
                                }
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Save successful:', data);
                        showToast('success', 'Changes saved successfully');
                        
                        // Reset edit state
                        cells.forEach(cell => {
                            cell.contentEditable = 'false';
                            cell.classList.remove('editing');
                            cell.removeAttribute('data-original');
                        });
                        
                        // Reset button states
                        editBtn.classList.remove('hidden');
                        saveBtn.classList.add('hidden');
                        downloadBtn.classList.remove('hidden');
                        downloadFormat.classList.remove('hidden');
                    })
                    .catch(error => {
                        console.error('Save error:', error);
                        showToast('error', error.message || 'Failed to save changes');
                    });
                });

                editBtn.addEventListener('click', function() {
                    const table = document.getElementById('dataTable');
                    if (!table) {
                        showToast('error', 'Table not found');
                        return;
                    }
                    
                    const tbody = table.querySelector('tbody');
                    if (!tbody) {
                        showToast('error', 'Table body not found');
                        return;
                    }

                    const tableCells = tbody.querySelectorAll('td');
                    if (tableCells.length === 0) {
                        showToast('error', 'No cells found in the table');
                        return;
                    }

                    tableCells.forEach(cell => {
                        // Store original value before making editable
                        cell.setAttribute('data-original', cell.textContent.trim());
                        cell.contentEditable = 'true';
                        cell.classList.add('editing');
                    });
                    
                    editBtn.classList.add('hidden');
                    saveBtn.classList.remove('hidden');
                    downloadBtn.classList.add('hidden');
                    downloadFormat.classList.add('hidden');
                    
                    showToast('success', 'Table is now editable');
                });

                // Statistical Analysis functionality
                const columnSelect = document.getElementById('columnSelect');
                const calculationType = document.getElementById('calculationType');
                const calculateBtn = document.getElementById('calculateBtn');
                const analysisResult = document.getElementById('analysisResult');
                const copyBtn = document.getElementById('copyStatsBtn');
                const resetBtn = document.getElementById('resetStatsBtn');

                // Initialize result and copy button visibility
                if (analysisResult) analysisResult.style.display = 'none';
                if (copyBtn) copyBtn.style.display = 'none';
                if (resetBtn) resetBtn.style.display = 'none';

                calculateBtn.addEventListener('click', function() {
                    if (!table || !thead || !tbody) {
                        showToast('error', 'Table not found. Please reload the page.');
                        return;
                    }

                    const column = columnSelect.value;
                    const calculation = calculationType.value;

                    if (!column || !calculation) {
                        showToast('error', 'Please select both column and calculation type');
                        return;
                    }

                    try {
                        // Add calculating state
                        this.classList.add('calculating');
                        this.disabled = true;  // Disable button during calculation

                        // Get all table cells from the selected column
                        const tableHeaders = Array.from(thead.querySelectorAll('th')).map(th => th.textContent.trim());
                        const columnIndex = tableHeaders.indexOf(column);
                        
                        if (columnIndex === -1) {
                            throw new Error('Column not found');
                        }

                        // Get column data
                        const columnData = Array.from(tbody.querySelectorAll('tr')).map(row => {
                            if (!row.cells || !row.cells[columnIndex]) return null;
                            const cell = row.cells[columnIndex];
                            const value = parseFloat(cell.textContent.trim());
                            return isNaN(value) ? null : value;
                        }).filter(val => val !== null);

                        if (columnData.length === 0) {
                            // Hide the output result and copy button
                            if (analysisResult) analysisResult.style.display = 'none';
                            if (copyBtn) copyBtn.style.display = 'none';
                            if (resetBtn) resetBtn.style.display = 'none';
                            throw new Error('No numeric data found in selected column');
                        }

                        let result;
                        switch (calculation) {
                            case 'mean':
                                result = columnData.reduce((a, b) => a + b, 0) / columnData.length;
                                break;
                            case 'median':
                                const sorted = [...columnData].sort((a, b) => a - b);
                                const mid = Math.floor(sorted.length / 2);
                                result = sorted.length % 2 === 0 
                                    ? (sorted[mid - 1] + sorted[mid]) / 2 
                                    : sorted[mid];
                                break;
                            case 'mode':
                                const counts = {};
                                columnData.forEach(val => counts[val] = (counts[val] || 0) + 1);
                                const maxCount = Math.max(...Object.values(counts));
                                result = Object.keys(counts).find(key => counts[key] === maxCount);
                                break;
                            case 'sum':
                                result = columnData.reduce((a, b) => a + b, 0);
                                break;
                            case 'count':
                                result = columnData.length;
                                break;
                            case 'min':
                                result = Math.min(...columnData);
                                break;
                            case 'max':
                                result = Math.max(...columnData);
                                break;
                            case 'stddev':
                                const mean = columnData.reduce((a, b) => a + b, 0) / columnData.length;
                                const squareDiffs = columnData.map(value => Math.pow(value - mean, 2));
                                const avgSquareDiff = squareDiffs.reduce((a, b) => a + b, 0) / columnData.length;
                                result = Math.sqrt(avgSquareDiff);
                                break;
                            case 'nullcount':
                                result = columnData.length - columnData.filter(val => val !== null).length;
                                break;
                            case 'nonnullcount':
                                result = columnData.filter(val => val !== null).length;
                                break;
                            case 'datatype':
                                result = Array.from(tbody.querySelectorAll('tr')).every(row => {
                                    const cell = row.cells[columnIndex];
                                    const value = cell.textContent.trim();
                                    return !isNaN(parseFloat(value));
                                }) ? 'Numeric' : 'Text';
                                break;
                            case 'statistics':
                                const stats = {};
                                stats.mean = columnData.reduce((a, b) => a + b, 0) / columnData.length;
                                stats.median = sorted.length % 2 === 0 
                                    ? (sorted[mid - 1] + sorted[mid]) / 2 
                                    : sorted[mid];
                                stats.mode = Object.keys(counts).find(key => counts[key] === maxCount);
                                stats.min = Math.min(...columnData);
                                stats.max = Math.max(...columnData);
                                stats.stddev = Math.sqrt(avgSquareDiff);
                                stats.nullcount = columnData.length - columnData.filter(val => val !== null).length;
                                stats.nonnullcount = columnData.filter(val => val !== null).length;
                                stats.datatype = Array.from(tbody.querySelectorAll('tr')).every(row => {
                                    const cell = row.cells[columnIndex];
                                    const value = cell.textContent.trim();
                                    return !isNaN(parseFloat(value));
                                }) ? 'Numeric' : 'Text';
                                result = JSON.stringify(stats, null, 2);
                                break;
                            default:
                                throw new Error('Invalid calculation type');
                        }

                        // Format the result
                        const formattedResult = typeof result === 'number' ? result.toFixed(2) : result;
                        const resultText = `${calculation.charAt(0).toUpperCase() + calculation.slice(1)} of ${column}: ${formattedResult}`;
                        
                        // Display result
                        if (analysisResult) {
                            analysisResult.textContent = resultText;
                            analysisResult.style.display = 'block';
                        }
                        
                        // Show copy button
                        if (copyBtn) {
                            copyBtn.style.display = 'inline-flex';
                        }
                        if (resetBtn) {
                            resetBtn.style.display = 'inline-flex';
                        }
                        
                        showToast('success', 'Calculation completed');
                    } catch (error) {
                        showToast('error', error.message);
                    } finally {
                        // Always remove calculating state and re-enable button
                        this.classList.remove('calculating');
                        this.disabled = false;
                    }
                });

                // Add copy functionality for statistics
                if (copyBtn) {
                    copyBtn.addEventListener('click', function() {
                        if (!analysisResult) return;
                        const resultText = analysisResult.textContent;
                        if (!resultText) return;

                        // Copy to clipboard
                        navigator.clipboard.writeText(resultText).then(() => {
                            showToast('success', 'Results copied to clipboard!');
                        }).catch(err => {
                            showToast('error', 'Failed to copy results');
                            console.error('Failed to copy:', err);
                        });
                    });
                }

                // Add reset functionality for statistics
                if (resetBtn) {
                    resetBtn.addEventListener('click', function() {
                        // Reset select inputs
                        if (columnSelect) columnSelect.value = columnSelect.options[0].value;
                        if (calculationType) calculationType.value = calculationType.options[0].value;
                        
                        // Clear the results
                        if (analysisResult) {
                            analysisResult.style.display = 'none';
                            analysisResult.textContent = '';
                        }
                        
                        // Hide buttons
                        copyBtn.style.display = 'none';
                        resetBtn.style.display = 'none';
                        
                        // Clear any highlighted cells
                        const cells = tbody.querySelectorAll('td');
                        cells.forEach(cell => {
                            cell.classList.remove('highlight');
                        });
                        
                        showToast('success', 'Statistics reset successfully');
                    });
                }

                // Reload Button Functionality
                document.getElementById('reloadBtn').addEventListener('click', function() {
                    const button = this;
                    const icon = button.querySelector('i');
                    const editBtn = document.getElementById('editBtn');
                    const saveBtn = document.getElementById('saveBtn');
                    const downloadBtn = document.getElementById('downloadBtn');
                    const downloadFormat = document.getElementById('downloadFormat');
                    
                    // Add spinning animation
                    button.classList.add('spinning');
                    
                    // Disable button during reload
                    button.disabled = true;
                    
                    // Reload the table data
                    fetch(window.location.href)
                        .then(response => response.text())
                        .then(html => {
                            const parser = new DOMParser();
                            const newDoc = parser.parseFromString(html, 'text/html');
                            
                            // Update table content
                            const newTable = newDoc.getElementById('dataTable');
                            const currentTable = document.getElementById('dataTable');
                            currentTable.innerHTML = newTable.innerHTML;
                            
                            // Update tbody reference after table content update
                            const tbody = currentTable.querySelector('tbody');
                            
                            // Update file info if needed
                            const newFileInfo = newDoc.querySelector('.file-info-grid');
                            const currentFileInfo = document.querySelector('.file-info-grid');
                            if (newFileInfo && currentFileInfo) {
                                currentFileInfo.innerHTML = newFileInfo.innerHTML;
                            }
                            
                            // Reset button states
                            saveBtn.classList.add('hidden');
                            editBtn.classList.remove('hidden');
                            
                            // Hide download button and format selector after reload
                            downloadBtn.classList.add('hidden');
                            downloadFormat.classList.add('hidden');
                            
                            // Make cells non-editable
                            const cells = currentTable.querySelectorAll('td');
                            cells.forEach(cell => {
                                cell.contentEditable = 'false';
                                cell.classList.remove('editing');
                            });
                            
                            showToast('success', 'Table data reloaded successfully');
                        })
                        .catch(error => {
                            console.error('Error reloading data:', error);
                            showToast('error', 'Error reloading data. Please try again.');
                        })
                        .finally(() => {
                            // Remove spinning animation and re-enable button after slight delay
                            setTimeout(() => {
                                button.classList.remove('spinning');
                                button.disabled = false;
                            }, 500);
                        });
                });

                // Add reload stats functionality
                document.getElementById('reloadStatsBtn').addEventListener('click', function() {
                    const button = this;
                    const icon = button.querySelector('i');
                    
                    // Add spinning animation
                    button.classList.add('spinning');
                    
                    // Disable button during reload
                    button.disabled = true;
                    
                    // Recalculate statistics
                    calculateStatistics(false); // Do not show messages when manually reloading
                    showToast('success', 'Statistics reloaded successfully');
                    
                    // Remove spinning animation and re-enable button after slight delay
                    setTimeout(() => {
                        button.classList.remove('spinning');
                        button.disabled = false;
                    }, 500);
                });

                // Add download functionality for statistics table
                const downloadStatsBtn = document.getElementById('downloadStatsBtn');
                const statsFormat = document.getElementById('statsFormat');
                
                if (downloadStatsBtn && statsFormat) {
                    downloadStatsBtn.addEventListener('click', function() {
                        const format = statsFormat.value;
                        const statisticsTable = document.querySelector('.statistics-table');
                        
                        if (!statisticsTable) {
                            showToast('error', 'Statistics table not found');
                            return;
                        }
                        
                        // Convert table to worksheet data
                        const rows = Array.from(statisticsTable.querySelectorAll('tr'));
                        const data = rows.map(row => 
                            Array.from(row.cells).map(cell => cell.textContent.trim())
                        );
                        
                        // Create a temporary table with the data
                        const tempTable = document.createElement('table');
                        data.forEach(rowData => {
                            const row = document.createElement('tr');
                            rowData.forEach(cellData => {
                                const cell = document.createElement('td');
                                cell.textContent = cellData;
                                row.appendChild(cell);
                            });
                            tempTable.appendChild(row);
                        });
                        
                        // Use the existing download endpoint
                        window.location.href = `/download/${fileIndex}/?format=${format}`;
                        
                        // Show success message
                        showToast('success', `Statistics table is being downloaded as ${format.toUpperCase()}`);
                    });
                }

                // Toast function
                function showToast(type, message) {
                    const toast = document.getElementById('successToast');
                    if (!toast) return;  // Guard clause if toast element doesn't exist
                    
                    // Set toast classes based on type
                    toast.className = 'toast align-items-center text-white border-0';
                    const toastIcon = toast.querySelector('.toast-icon');
                    
                    if (type === 'success') {
                        toast.classList.add('bg-success');
                        toastIcon.className = 'toast-icon fas fa-check-circle';
                    } else if (type === 'error') {
                        toast.classList.add('bg-danger');
                        toastIcon.className = 'toast-icon fas fa-exclamation-circle';
                    } else if (type === 'info') {
                        toast.classList.add('bg-info');
                        toastIcon.className = 'toast-icon fas fa-info-circle';
                    }
                    
                    // Set message
                    const toastBody = toast.querySelector('.toast-body');
                    if (toastBody) {
                        toastBody.textContent = message;
                    }
                    
                    // Show toast using Bootstrap
                    const bsToast = new bootstrap.Toast(toast, {
                        animation: true,
                        autohide: true,
                        delay: 3000
                    });
                    bsToast.show();
                }

                // Save button click handler
                saveBtn.addEventListener('click', function() {
                    const table = document.getElementById('dataTable');
                    if (!table) {
                        showToast('error', 'Table not found');
                        return;
                    }
                    
                    const tbody = table.querySelector('tbody');
                    if (!tbody) {
                        showToast('error', 'Table body not found');
                        return;
                    }

                    const thead = table.querySelector('thead');
                    if (!thead) {
                        showToast('error', 'Table header not found');
                        return;
                    }

                    // Get edited cells and check for changes
                    const cells = tbody.querySelectorAll('td');
                    let hasChanges = false;
                    
                    cells.forEach(cell => {
                        if (cell.classList.contains('editing')) {
                            const originalValue = cell.getAttribute('data-original') || '';
                            const currentValue = cell.textContent.trim();
                            if (originalValue !== currentValue) {
                                hasChanges = true;
                            }
                        }
                    });
                    
                    if (!hasChanges) {
                        showToast('error', 'Nothing to save. Please edit the table to save changes.');
                        return;
                    }

                    // Prepare data for saving
                    const headers = Array.from(thead.querySelectorAll('th')).map(th => th.textContent.trim());
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    const data = rows.map(row => {
                        const rowData = {};
                        headers.forEach((header, index) => {
                            rowData[header] = row.cells[index].textContent.trim();
                        });
                        return rowData;
                    });

                    // Save changes
                    fetch(`/save_changes/${fileIndex}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify({ data: data })
                    })
                    .then(response => {
                        console.log('Server response status:', response.status);
                        if (!response.ok) {
                            return response.text().then(text => {
                                console.error('Server error response:', text);
                                try {
                                    const errorData = JSON.parse(text);
                                    throw new Error(errorData.error || 'Failed to save changes');
                                } catch (e) {
                                    throw new Error('Failed to save changes');
                                }
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Save successful:', data);
                        showToast('success', 'Changes saved successfully');
                        
                        // Reset edit state
                        cells.forEach(cell => {
                            cell.contentEditable = 'false';
                            cell.classList.remove('editing');
                            cell.removeAttribute('data-original');
                        });
                        
                        // Reset button states
                        editBtn.classList.remove('hidden');
                        saveBtn.classList.add('hidden');
                        downloadBtn.classList.remove('hidden');
                        downloadFormat.classList.remove('hidden');
                    })
                    .catch(error => {
                        showToast('error', error.message);
                    });
                });
            });
        </script>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add animation classes on load
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation classes to elements
        document.querySelectorAll('.section').forEach((section, index) => {
            section.style.animationDelay = `${index * 0.1}s`;
            section.classList.add('animate-fade-in');
        });

        // Add hover effects to buttons
        document.querySelectorAll('.btn').forEach(btn => {
            btn.classList.add('modern-btn');
        });

        // Keep existing JavaScript
    });
</script>
{% endblock %}
